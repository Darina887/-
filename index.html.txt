
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Новогодний салат</title>
<style>
    body {
        margin: 0;
        background: #0b132b;
        overflow: hidden;
        touch-action: none;
        font-family: monospace;
    }
    canvas {
        display: block;
        margin: 0 auto;
        image-rendering: pixelated;
    }
</style>
</head>
<body>

<canvas id="game" width="320" height="480"></canvas>

<audio id="music" loop autoplay>
    <!-- замените файл на свой -->
    <source src="https://cdn.pixabay.com/download/audio/2022/12/20/audio_0cfa0a63a4.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let lives = 5;
let gameOver = false;

const player = {
    x: 140,
    y: 420,
    width: 40,
    height: 40,
    speed: 4
};

let salad = {
    x: Math.random() * 280,
    y: -20,
    size: 20,
    speed: 2
};

const keys = {};

// Управление клавиатурой
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// Управление касанием
canvas.addEventListener("touchmove", e => {
    player.x = e.touches[0].clientX / window.innerWidth * canvas.width - player.width / 2;
});

// Рисуем мужчину
function drawPlayer() {
    ctx.fillStyle = "#3a86ff"; // пальто
    ctx.fillRect(player.x, player.y + 10, 40, 30);

    ctx.fillStyle = "#ffd166"; // лицо
    ctx.fillRect(player.x + 10, player.y, 20, 15);

    ctx.fillStyle = "#000";
    ctx.fillRect(player.x + 8, player.y - 5, 24, 6); // шапка

    ctx.fillStyle = "#fff";
    ctx.fillRect(player.x + 5, player.y + 35, 30, 5); // тарелка
}

// Рисуем салат
function drawSalad() {
    ctx.fillStyle = "#2ecc71";
    ctx.fillRect(salad.x, salad.y, salad.size, salad.size);

    ctx.fillStyle = "#fff"; // майонез
    ctx.fillRect(salad.x + 5, salad.y + 5, 10, 10);
}

// Ёлки-жизни
function drawLives() {
    for (let i = 0; i < lives; i++) {
        ctx.fillStyle = "#2ecc71";
        ctx.fillRect(10 + i * 18, 10, 10, 15);
        ctx.fillStyle = "#8d5524";
        ctx.fillRect(14 + i * 18, 25, 2, 5);
    }
}

// Проверка столкновения
function collision() {
    return (
        salad.x < player.x + player.width &&
        salad.x + salad.size > player.x &&
        salad.y + salad.size > player.y + 35
    );
}

// Game Over экран
function drawGameOver() {
    ctx.fillStyle = "rgba(0,0,0,0.8)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "#fff";
    ctx.font = "14px monospace";
    ctx.textAlign = "center";
    ctx.fillText(
        "Вы не смогли съесть все салаты",
        canvas.width / 2,
        220
    );
    ctx.fillText(
        "с новогоднего стола.",
        canvas.width / 2,
        240
    );
    ctx.fillText(
        "Заверните остальные друзьям",
        canvas.width / 2,
        260
    );
}

// Основной цикл
function update() {
    if (gameOver) {
        drawGameOver();
        return;
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (keys["ArrowLeft"]) player.x -= player.speed;
    if (keys["ArrowRight"]) player.x += player.speed;

    player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));

    salad.y += salad.speed;

    if (collision()) {
        salad.y = -20;
        salad.x = Math.random() * 280;
        salad.speed += 0.1;
    }

    if (salad.y > canvas.height) {
        lives--;
        salad.y = -20;
        salad.x = Math.random() * 280;

        if (lives <= 0) {
            gameOver = true;
        }
    }

    drawPlayer();
    drawSalad();
    drawLives();

    requestAnimationFrame(update);
}

update();
</script>

</body>
</html>
